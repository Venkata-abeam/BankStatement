sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/library","sap/ui/export/library","sap/m/library","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Sorter","sap/ui/model/Filter","sap/m/SearchField","sap/ui/table/Column","sap/m/Column","sap/m/Label","sap/ui/model/type/String","sap/ui/comp/library","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/core/message/Message","sap/ushell/Container","sap/ui/export/Spreadsheet","sap/m/MessageBox"],(e,t,a,o,n,s,i,r,l,u,d,p,c,g,h,m,v,k,y,f,C)=>{"use strict";var w,b,V;var H=t.ValueState,B=a.EdmType,T=o.DialogType;var _,I,D,S;var M=new sap.ui.model.json.JSONModel;var A=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait..."});return e.extend("bankstatement.controller.bankstatement_view",{onInit(){w=new sap.ui.model.json.JSONModel({start:"",end:""});if(sap.ushell&&sap.ushell.Container){var e=sap.ushell.Container.getService("UserInfo");if(e){S=e.getEmail();if(!S){S="jzhou@gradiant.com"}}else{S="jzhou@gradiant.com"}}else{S="jzhou@gradiant.com"}},handleDateChange:function(e){var t=this;var a=[],o=e.getParameter("from"),n=e.getParameter("to"),s=e.getParameter("value"),i=e.getParameter("valid"),r=e.getSource();if(i){r.setValueState(H.None);r.setValueStateText("");b=o;V=n;w=new sap.ui.model.json.JSONModel({start:o,end:n});w.refresh();t.getView().setModel(w,"DateModel")}else{r.setValueState(H.Error);r.setValueStateText("Invalid Date Range")}},housebankVH:async function(e){var t=this.getView();var a=this;var o=[],r;var l=this.getView().byId("id_companyCode").getTokens();if(l.length>0){var u=this.getOwnerComponent().getModel("HouseBankVH");A.open();var d=[];l.map(function(e){d.push(new sap.ui.model.Filter("CompanyCode","EQ",e.getText()))});r=new sap.ui.model.Filter({filters:d,and:false});o.push(r);let e=await this._getHouseBank(u,o);if(e.length>0){u=new sap.ui.model.json.JSONModel;var p=[];for(var c=0;c<e.length;c++){var g={};g.HouseBank=e[c].HouseBank;g.BankName=e[c].BankName;p.push(g)}u.setData(p);a.getView().setModel(u,"HouseBanks");u.refresh()}if(!this._pValueHelpDialogHouseBank){this._pValueHelpDialogHouseBank=v.load({id:t.getId(),name:"bankstatement.view.BankVH",controller:this}).then(function(e){t.addDependent(e);return e})}A.close();this._pValueHelpDialogHouseBank.then(function(e){e.open()})}else{this.oCcodeHouseBankMessageDialog=new n({type:T.Message,title:"Error",state:H.Error,content:new i({text:"Please Select Company Code"}),beginButton:new s({type:T.Emphasized,text:"Ok",press:function(){this.oCcodeHouseBankMessageDialog.close()}.bind(this)})});this.oCcodeHouseBankMessageDialog.open()}},onValueHelpHouseBankClose:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("id_housebank");if(t){var o=t.getTitle();a.setValue(o)}},_getHouseBank:async function(e,t){return new Promise((a,o)=>{e.read("/HouseBankVH",{filters:t,urlParameters:{$top:999999},success:function(e){a(e.results)}.bind(this),error:function(e){o(e)}.bind(this)})})},housebankAccVH:async function(){var e=this.getView();var t=this;var a=[],o,r;var l=[],u=[];var d=e.byId("id_housebank").getTokens();var p=e.byId("id_companyCode").getTokens();if(d.length>0){p.map(function(e){l.push(new sap.ui.model.Filter("CompanyCode","EQ",e.getText()))});o=new sap.ui.model.Filter({filters:l,and:false});a.push(o);d.map(function(e){u.push(new sap.ui.model.Filter("HouseBank","EQ",e.getText()))});r=new sap.ui.model.Filter({filters:u,and:false});a.push(r);var c=this.getOwnerComponent().getModel("HouseBankAccVH");A.open();let n=await this._getHouseAccBank(c,a);console.log(n);if(n.length>0){c=new sap.ui.model.json.JSONModel;var g=[];for(var h=0;h<n.length;h++){var m={};m.HouseBankAccount=n[h].HouseBankAccount;m.BankAccountDescription=n[h].BankAccountDescription;g.push(m)}c.setData(g);t.getView().setModel(c,"HouseBankAccounts");c.refresh()}if(!this._pValueHelpDialogHouseBankAcc){this._pValueHelpDialogHouseBankAcc=v.load({id:e.getId(),name:"bankstatement.view.HouseBankAccountVH",controller:this}).then(function(t){e.addDependent(t);return t})}A.close();this._pValueHelpDialogHouseBankAcc.then(function(e){e.open()})}else{this.oCcodeMessageDialog=new n({type:T.Message,title:"Error",state:H.Error,content:new i({text:"Please Select House Bank"}),beginButton:new s({type:T.Emphasized,text:"Ok",press:function(){this.oCcodeMessageDialog.close()}.bind(this)})});this.oCcodeMessageDialog.open()}},onValueHelpHouseBankAccClose:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("id_housebankacc");if(t){var o=t.getTitle();var n=t.getDescription();a.setValue(o)}},ccodeVH:async function(e){var t=this.getView();var a=this;var o=[];var n=new sap.ui.model.Filter("EmailAddress","EQ",S);o.push(n);var s=this.getOwnerComponent().getModel("CompanyCodeVH");A.open();let i=await this._getCompanyCode(s,o);if(i.length>0){D=new sap.ui.model.json.JSONModel;var r=[];for(var l=0;l<i.length;l++){var u={};u.CompanyCode=i[l].CompanyCode;u.CompanyCodeName=i[l].CompanyCodeName;r.push(u)}D.setData(r);a.getView().setModel(D,"CompanyCodes");D.refresh()}if(!this._pValueHelpDialogCompanyCode){this._pValueHelpDialogCompanyCode=v.load({id:t.getId(),name:"bankstatement.view.CCodeVH",controller:this}).then(function(e){t.addDependent(e);return e})}A.close();this._pValueHelpDialogCompanyCode.then(function(e){e.open()})},onValueHelpCCodeClose:function(e){var t=e.getParameter("selectedItem");var a=this.getView().byId("id_companyCode");if(t){var o=t.getTitle();a.setValue(o)}},_getHouseAccBank:async function(e,t){return new Promise((a,o)=>{e.read("/BankAccountVH",{filters:t,urlParameters:{$top:999999},success:function(e){a(e.results)}.bind(this),error:function(e){o(e)}.bind(this)})})},_getCompanyCode:async function(e,t){return new Promise((a,o)=>{e.read("/CompanyCodeVH",{filters:[t],urlParameters:{$top:999999},success:function(e){a(e.results)}.bind(this),error:function(e){o(e)}.bind(this)})})},_getBankStatement:async function(e,t){return new Promise((a,o)=>{e.read("/BankStatement",{filters:t,urlParameters:{$top:999999},success:function(e){a(e.results)}.bind(this),error:function(e){o(e)}.bind(this)})})},onSearch:async function(e){var t=this.getView().byId("id_companyCode").getTokens();var a=this.getView().byId("id_housebank").getTokens();var o=this.getView().byId("id_housebankacc").getTokens();var r=this.getView().byId("id_title");var l=b;var u=V;if(t.length<0||l===undefined||u===undefined||l===""||u===""){this.oFillMessageDialog=new n({type:T.Message,title:"Error",state:H.Error,content:new i({text:"CompanyCode & Date are Mandatory"}),beginButton:new s({type:T.Emphasized,text:"Ok",press:function(){this.oFillMessageDialog.close()}.bind(this)})});this.oFillMessageDialog.open()}else{A.open();var d=[];var p,c,g,h;var m=[],v=[],k=[];var y=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var f=y.format(new Date(l));var C=y.format(new Date(u));if(t.length>0){t.map(function(e){m.push(new sap.ui.model.Filter("CompanyCode","EQ",e.getText()))});p=new sap.ui.model.Filter({filters:m,and:false});d.push(p)}if(f&&C){c=new sap.ui.model.Filter("DateRange","BT",f,C);d.push(c)}else{c=new sap.ui.model.Filter("DateRange","BT",f,C);d.push(c)}if(a.length>0){a.map(function(e){v.push(new sap.ui.model.Filter("HouseBank","EQ",e.getText()))});g=new sap.ui.model.Filter({filters:v,and:false});d.push(g)}if(o.length>0){o.map(function(e){k.push(new sap.ui.model.Filter("HouseBankAccount","EQ",e.getText()))});h=new sap.ui.model.Filter({filters:k,and:false});d.push(h)}var w=this.getOwnerComponent().getModel();let e=await this._getBankStatement(w,d);if(e.length>0){M.setData(e);this.getView().setModel(M,"BankStatements");M.refresh();var B="Bank Statement Report"+"("+e.length+")";r.setText(B)}else{e=[];M.setData(e);this.getView().setModel(M,"BankStatements");M.refresh();var B="Bank Statement Report";r.setText(B)}A.close()}},onValueHelpHouseBankSearch:async function(e){var t=e.getParameter("value");var a=[],o,n;var s=this;var i=this.getView().byId("id_companyCode").getTokens();if(i.length>0){var r=[];i.map(function(e){r.push(new sap.ui.model.Filter("CompanyCode","EQ",e.getText()))});o=new sap.ui.model.Filter({filters:r,and:false});a.push(o)}if(t){n=new sap.ui.model.Filter("HouseBank","EQ",t);a.push(n)}if(!i&&!t){a=[]}var l=this.getOwnerComponent().getModel("HouseBankVH");let u=await this._getHouseBank(l,a);if(u.length>0){l=new sap.ui.model.json.JSONModel;var d=[];for(var p=0;p<u.length;p++){var c={};c.HouseBank=u[p].HouseBank;c.BankName=u[p].BankName;d.push(c)}l.setData(d);s.getView().setModel(l,"HouseBanks");l.refresh()}},onValueHelpCCodeSearch:async function(e){var t=e.getParameter("value");var a=[],o;var n=this;if(t){o=new sap.ui.model.Filter("CompanyCode","EQ",t);a.push(o)}else{a=[]}var s=this.getOwnerComponent().getModel("CompanyCodeVH");A.open();let i=await this._getCompanyCode(s,a);if(i.length>0){D=new sap.ui.model.json.JSONModel;var r=[];for(var l=0;l<i.length;l++){var u={};u.CompanyCode=i[l].CompanyCode;u.CompanyCodeName=i[l].CompanyCodeName;r.push(u)}D.setData(r);n.getView().setModel(D,"CompanyCodes");D.refresh()}A.close()},OnVHccodeSelected:function(e){var t=this.getView().byId("id_ccode_value_help"),a=this.getView().byId("idccodevaluehelp");var o=e.getParameter("selected");var n=e.getParameter("removed");var s=e.getParameter("selectAll");var i=a.getSelectedItems();var r=e.getParameter("listItem").getCells()[0].getText();var l=t.getTokens();if(s===true){var u=a.getModel("CompanyCodes");var d=u.getProperty("/");var p=-1;for(var c=0;c<d.length;c++){t.addToken(new sap.m.Token({key:d[c].CompanyCode,text:d[c].CompanyCode}))}t.removeToken(p)}else if(o===true){t.addToken(new sap.m.Token({key:r,text:r}))}else{for(var c=0;c<l.length;c++){if(l[c].getKey()===r||l[c].getText()===r){p=c;break}}t.removeToken(p)}},onccodeSearch:async function(e){var t=this.getOwnerComponent().getModel("CompanyCodeVH"),a=this.getView().byId("idccodevaluehelp"),o=e.getSource().getValue(),n=this,s=[],i,r;if(S){r=new sap.ui.model.Filter("EmailAddress","EQ",S);s.push(r)}if(o){i=new sap.ui.model.Filter("CompanyCode","EQ",o);s.push(i)}a.removeSelections(true);let l=await this._getCompanyCode(t,s);if(l.length>0){D=new sap.ui.model.json.JSONModel;var u=[];for(var d=0;d<l.length;d++){var p={};p.CompanyCode=l[d].CompanyCode;p.CompanyCodeName=l[d].CompanyCodeName;u.push(p)}D.setData(u);n.getView().setModel(D,"CompanyCodes");D.refresh()}},okccodeVHDialog:function(e){var t=this.getView().byId("idccodevaluehelp");var a=this.getView().byId("id_ccode_value_help");var o=this.getView().byId("id_companyCode");o.removeAllTokens();var n=a.getTokens();n.forEach(function(e){if(e){o.addToken(e)}});if(n.length===0){o.removeAllTokens()}this.getView().byId("ccodeVHDialog").close();t.removeSelections(true)},closeccodeVHDialog:function(e){var t=this.getView().byId("id_ccode_value_help");var a=this.getView().byId("idccodevaluehelp");a.removeSelections(true);t.removeAllTokens();this.getView().byId("ccodeVHDialog").close()},onclearccodeVH:function(e){var t=this.getView().byId("idccodevaluehelp");var a=this.getView().byId("id_ccode_value_help");t.removeSelections(true);a.removeAllTokens()},OnVHbankSelected:function(e){var t=this.getView().byId("id_bank_value_help"),a=this.getView().byId("idbankvaluehelp");var o=e.getParameter("selected");var n=e.getParameter("removed");var s=e.getParameter("selectAll");var i=a.getSelectedItems();var r=e.getParameter("listItem").getCells()[0].getText();var l=t.getTokens();if(s===true){var u=a.getModel("HouseBanks");var d=u.getProperty("/");var p=-1;for(var c=0;c<d.length;c++){t.addToken(new sap.m.Token({key:d[c].HouseBank,text:d[c].HouseBank}))}t.removeToken(p)}else if(o===true){t.addToken(new sap.m.Token({key:r,text:r}))}else{for(var c=0;c<l.length;c++){if(l[c].getKey()===r||l[c].getText()===r){p=c;break}}t.removeToken(p)}},onValueHelpHouseBankok:function(e){var t=this.getView().byId("idbankvaluehelp");var a=this.getView().byId("id_bank_value_help");var o=this.getView().byId("id_housebank");o.removeAllTokens();var n=a.getTokens();n.forEach(function(e){if(e){o.addToken(e)}});if(n.length===0){o.removeAllTokens()}this.getView().byId("selectBankVH").close();t.removeSelections(true)},onValueHelpHouseBankClose:function(e){var t=this.getView().byId("id_bank_value_help");var a=this.getView().byId("idbankvaluehelp");a.removeSelections(true);t.removeAllTokens();this.getView().byId("selectBankVH").close()},OnVHbankaccSelected:function(e){var t=this.getView().byId("id_bankacc_value_help"),a=this.getView().byId("idbankaccvaluehelp");var o=e.getParameter("selected");var n=e.getParameter("removed");var s=e.getParameter("selectAll");var i=a.getSelectedItems();var r=e.getParameter("listItem").getCells()[0].getText();var l=t.getTokens();if(s===true){var u=a.getModel("HouseBankAccounts");var d=u.getProperty("/");var p=-1;for(var c=0;c<d.length;c++){t.addToken(new sap.m.Token({key:d[c].HouseBankAccount,text:d[c].HouseBankAccount}))}t.removeToken(p)}else if(o===true){t.addToken(new sap.m.Token({key:r,text:r}))}else{for(var c=0;c<l.length;c++){if(l[c].getKey()===r||l[c].getText()===r){p=c;break}}t.removeToken(p)}},onValueHelpHouseBankAccok:function(e){var t=this.getView().byId("idbankaccvaluehelp");var a=this.getView().byId("id_bankacc_value_help");var o=this.getView().byId("id_housebankacc");o.removeAllTokens();var n=a.getTokens();n.forEach(function(e){if(e){o.addToken(e)}});if(n.length===0){o.removeAllTokens()}this.getView().byId("selectBankAccVH").close();t.removeSelections(true)},onValueHelpHouseBankAccClose:function(e){var t=this.getView().byId("id_bankacc_value_help");var a=this.getView().byId("idbankaccvaluehelp");a.removeSelections(true);t.removeAllTokens();this.getView().byId("selectBankAccVH").close()},onclearbankaccVH:function(){var e=this.getView().byId("idbankaccvaluehelp");var t=this.getView().byId("id_bankacc_value_help");e.removeSelections(true);t.removeAllTokens()},onExport:function(){var e,t,a,o,n;if(!this._oTable){this._oTable=this.byId("table1")}n=this._oTable;t=n.getBinding("rows");e=this._createColumnConfig();a={workbook:{columns:e,hierarchyLevel:"Level"},dataSource:t,fileName:"Bank Statement.xlsx"};o=new f(a);o.build().finally(function(){o.destroy()})},_createColumnConfig:function(){var e=[];e.push({label:"Company Code",type:B.String,property:"CompanyCode"});e.push({label:"CompanyCode Name",property:"CompanyCodeName",type:B.String});e.push({label:"House Bank",property:"HouseBank",type:B.String});e.push({label:"HouseBank Account",property:"HouseBankAccount",type:B.String});e.push({label:"Bank Name",property:"BankName",type:B.String});e.push({label:"BankAccount",property:"BankAccount",type:B.String});e.push({label:"BankAccount Description",property:"BankAccountDescription",type:B.String});e.push({label:"Opening Balance",property:"OpeningBalance",type:B.Decimal});e.push({label:"Opening Date",property:"OpenDate",type:B.String});e.push({label:"Closing Balance",property:"ClosingBalance",type:B.Decimal});e.push({label:"Close Date",property:"CloseDate",type:B.String});e.push({label:"CashIn flow",property:"CashInflow",type:B.Decimal});e.push({label:"CashOut flow",property:"CashOutflow",type:B.Decimal});return e}})});
//# sourceMappingURL=bankstatement_view.controller.js.map